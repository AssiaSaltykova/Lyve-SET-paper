{
    "contents" : "#!/usr/bin/env r\n\n# Last updated: 07 December 2015\n\n# Load required libraries\nsuppressMessages(library(docopt)) # arg parsing\nsuppressMessages(library(vegan))  # Mantel function\n\n# Configure arg parsing\ndoc <- \"Description: SNPRMan (pronounced 'Sniper-Man'): Single Nucelotide Polymorphism matrix comparisons in R via Mantel is an R script for running a Mantel test to quantify the correlation between two SNP distance matrices. This is an alternative and/or complementary method to comparing tree topologies.\n\nAuthor: A. Jo Williams-Newkirk at igy7@cdc.gov.\n\nDependencies:\n  Unix: littleR\n  R:    docopt, vegan\n\nUsage: SNPRMan.R -f <first_matrix> -s <second_matrix> [-c <corr> -p <perms> -o <outfile>]\n       SNPRMan.R -v\n       SNPRMan.R -h\n\nOptions:\n-f <first_matrix>, --first_matrix=<first_matrix>        Tab-delimited file containing first matrix; required\n-s <second_matrix>, --second_matrix=<second_matrix>     Tab-delimited file containing second matrix; required\n-c <corr>, --corr=<corr>                                Correlation method either 'pearson' (parametric), 'spearman' (non-parametric), or 'kendall' (non-parametric); optional [default: spearman]\n-p <perms>, --perms=<perms>                             Number of permutations; optional [default: 1000]\n-o <outfile>, --outfile=<outfile>                       Output file name; optional [default: SNPRMan.output]\n-h --help                                               Show this help text\n-v --version                                            Show version\"\n\n\n# Version\nver = \"0.1\"\n\n# Parse args\nopt <- docopt(doc = doc, version = ver)\n\n## Functions\n\n# Import matrix file\nimpDist <- function(infile) {\n  # read in file\n  tmp <- read.delim(file = infile, \n                    header = TRUE, \n                    row.names = 1, \n                    sep = \"\\t\", \n                    stringsAsFactors = FALSE)\n  # check for and remove empty columns from badly formatted files\n  if(all(is.na(tmp[,length(colnames(tmp))])) == TRUE) {\n    tmp[,length(colnames(tmp))] <- NULL\n  }\n  # change any '-' to proper 0's\n  tmp[tmp == '-'] = '0'\n  # change data type to numeric\n  tmp <- apply(tmp, 2, as.numeric)\n  # fix the row names\n  rownames(tmp) <- colnames(tmp)\n  tmp <- as.dist(tmp)\n  return(tmp)\n}\n\n## End functions\n\n# Import matrix files.\nm1 <- impDist(opt$first_matrix)\nm2 <- impDist(opt$second_matrix)\n\n# Run Mantel test\ntest <- mantel(xdis = m1, \n        ydis = m2, \n        method = opt$corr, \n        permutations = as.numeric(opt$perms))\n\n# Write log file\nfileConn <- file(opt$outfile)\nwriteLines(c(paste(\"SNPRMan.R. version\", ver),\n             R.version.string, \n             paste(\"Package Vegan version:\", packageVersion(\"vegan\")),\n             paste(\"Time:\", Sys.time()),\n             paste(\"Date:\", Sys.Date()),\n             paste(\"First matrix file:\", opt$first_matrix),\n             paste(\"Second matrix file:\", opt$second_matrix),\n             paste(\"Correlation method requested:\", opt$corr),\n             paste(\"Correlation method used:\", test$method),\n             paste(\"Number of permutations requested:\", opt$perms),\n             paste(\"Number of permutations performed:\", test$permutations),\n             paste(\"Mantel statistic r:\", test$statistic),\n             paste(\"r^2:\", as.numeric(test$statistic)^2),\n             paste(\"P-value (by permutation):\", test$signif)\n             ),\n           fileConn)\nclose(fileConn)",
    "created" : 1449500230310.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3018065920",
    "id" : "D885A463",
    "lastKnownWriteTime" : 1449508213,
    "path" : "~/Projects/SNPRMan/SNPRMan.R",
    "project_path" : "SNPRMan.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}